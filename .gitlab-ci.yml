stages:
  - deploy

deploy_staging:
  stage: deploy
  tags:
    - shell
  script:
    - echo "Starting staging deploy"
    - cd /root/staging
    - git fetch origin
    - git checkout develop
    - git reset --hard origin/develop
    - docker-compose pull
    - docker-compose up -d --build
    - echo "Staging updated successfully"
  only:
    - develop

deploy_production:
  stage: deploy
  tags:
    - shell
  script:
    - echo "Starting production deploy"
    - cd /root/app-prod
    - git fetch origin
    - git checkout main
    - git reset --hard origin/main
    - docker-compose pull
    - docker-compose up -d --build
    - echo "Production updated successfully"
  only:
    - main