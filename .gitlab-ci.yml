stages:
  - deploy

deploy_staging:
  stage: deploy
  script:
    - echo "üõ† –ù–∞—á–∏–Ω–∞–µ–º –¥–µ–ø–ª–æ–π –Ω–∞ Staging..."
    - eval $(ssh-agent -s)
    - echo "$DEPLOY_SSH_PRIVATE_KEY" | tr -d '\r' | ssh-add -
    - ssh -o StrictHostKeyChecking=no $SERVER_USER@$SERVER_HOST "
        cd $SERVER_PATH_STAGING &&
        git fetch origin &&
        git checkout develop &&
        git reset --hard origin/develop &&
        docker-compose pull &&
        docker-compose up -d --build
      "
    - echo "‚úÖ Staging –æ–±–Ω–æ–≤–ª—ë–Ω: https://staging.–∏–≥—Ä—ã–≤–µ–∫–æ–≤.—Ä—Ñ"
  only:
    - develop

deploy_production:
  stage: deploy
  script:
    - echo "üöÄ –ù–∞—á–∏–Ω–∞–µ–º –¥–µ–ø–ª–æ–π –Ω–∞ Production..."
    - eval $(ssh-agent -s)
    - echo "$DEPLOY_SSH_PRIVATE_KEY" | tr -d '\r' | ssh-add -
    - ssh -o StrictHostKeyChecking=no $SERVER_USER@$SERVER_HOST "
        cd $SERVER_PATH_PROD &&
        git fetch origin &&
        git checkout main &&
        git reset --hard origin/main &&
        docker-compose pull &&
        docker-compose up -d --build
      "
    - echo "‚úÖ Production –æ–±–Ω–æ–≤–ª—ë–Ω: https://–∏–≥—Ä—ã–≤–µ–∫–æ–≤.—Ä—Ñ"
  only:
    - main